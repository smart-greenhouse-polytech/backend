# Smart Greenhouse Backend

–≠—Ç–æ backend-–ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –¥–ª—è —Å–∏—Å—Ç–µ–º—ã "–£–º–Ω–∞—è —Ç–µ–ø–ª–∏—Ü–∞". –û–Ω–æ —É–ø—Ä–∞–≤–ª—è–µ—Ç –¥–∞–Ω–Ω—ã–º–∏ —Å –¥–∞—Ç—á–∏–∫–æ–≤, –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤—É–µ—Ç —Å –±–∞–∑–æ–π –¥–∞–Ω–Ω—ã—Ö PostgreSQL –∏ MQTT –±—Ä–æ–∫–µ—Ä–æ–º (Mosquitto).

---

## –°–æ–¥–µ—Ä–∂–∞–Ω–∏–µ
1. [–û–ø–∏—Å–∞–Ω–∏–µ —Å–µ—Ä–≤–∏—Å–∞](#–æ–ø–∏—Å–∞–Ω–∏–µ-—Å–µ—Ä–≤–∏—Å–∞)
2. [–ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è](#–ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ-–æ–∫—Ä—É–∂–µ–Ω–∏—è)
3. [CI/CD Pipeline](#ci-cd-pipeline)
4. [–õ–æ–∫–∞–ª—å–Ω–∞—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∞](#–ª–æ–∫–∞–ª—å–Ω–∞—è-—Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∞)

---

## –û–ø–∏—Å–∞–Ω–∏–µ —Å–µ—Ä–≤–∏—Å–∞

–°–µ—Ä–≤–∏—Å –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è–µ—Ç REST API –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –¥–∞–Ω–Ω—ã–º–∏ —Ç–µ–ø–ª–∏—Ü—ã:
- **–î–∞—Ç—á–∏–∫–∏**: –¢–µ–º–ø–µ—Ä–∞—Ç—É—Ä–∞, –≤–ª–∞–∂–Ω–æ—Å—Ç—å, –æ—Å–≤–µ—â–µ–Ω–Ω–æ—Å—Ç—å.
- **–£—Å—Ç—Ä–æ–π—Å—Ç–≤–∞**: –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å–≤–µ—Ç–æ–º, –ø–æ–ª–∏–≤–æ–º, –≤–µ–Ω—Ç–∏–ª—è—Ü–∏–µ–π.
- **–ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö**: –•—Ä–∞–Ω–µ–Ω–∏–µ –∏—Å—Ç–æ—Ä–∏–∏ –ø–æ–∫–∞–∑–∞–Ω–∏–π.
- **MQTT**: –í–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏–µ —Å IoT —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞–º–∏.

---

## –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è

### –û—Å–Ω–æ–≤–Ω—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ (application-prod.yml)

| –ü–µ—Ä–µ–º–µ–Ω–Ω–∞—è               | –û–ø–∏—Å–∞–Ω–∏–µ                     | –ó–Ω–∞—á–µ–Ω–∏–µ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é                              |
|--------------------------|------------------------------|----------------------------------------------------|
| `DB_HOST`                | –•–æ—Å—Ç PostgreSQL              | `polytech-smart-greenhouse-postgres`               |
| `DB_PORT`                | –ü–æ—Ä—Ç PostgreSQL              | `5432`                                             |
| `DB_NAME`                | –ò–º—è –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö              | `polytech-smart-house`                             |
| `DB_USER`                | –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å PostgreSQL      | `user`                                             |
| `DB_PASSWORD`            | –ü–∞—Ä–æ–ª—å PostgreSQL            | `password`                                         |
| `MQTT_HOST`              | –•–æ—Å—Ç MQTT –±—Ä–æ–∫–µ—Ä–∞            | `polytech-smart-greenhouse-mosquitto`              |
| `MQTT_PORT`              | –ü–æ—Ä—Ç MQTT –±—Ä–æ–∫–µ—Ä–∞            | `1883`                                             |
| `SPRING_PROFILES_ACTIVE` | –ê–∫—Ç–∏–≤–Ω—ã–π –ø—Ä–æ—Ñ–∏–ª—å Spring Boot | `prod`                                             |
| `JAVA_OPTS`              | –ü–∞—Ä–∞–º–µ—Ç—Ä—ã JVM                | `-XX:+UseContainerSupport -XX:MaxRAMPercentage=75` |

---

## CI CD Pipeline

GitHub Actions –∞–≤—Ç–æ–º–∞—Ç–∏–∑–∏—Ä—É–µ—Ç —Å–±–æ—Ä–∫—É, —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∏ –¥–µ–ø–ª–æ–π –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è.

### –≠—Ç–∞–ø—ã CI/CD:
1. **–°–±–æ—Ä–∫–∞ –∏ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ**:
    - –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç JDK 21.
    - –ó–∞–ø—É—Å–∫–∞–µ—Ç Docker Compose –¥–ª—è –ø–æ–¥–Ω—è—Ç–∏—è –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π (Postgres, Mosquitto).
    - –í—ã–ø–æ–ª–Ω—è–µ—Ç —Å–±–æ—Ä–∫—É –∏ —Ç–µ—Å—Ç—ã —Å –ø–æ–º–æ—â—å—é Maven.

2. **–î–µ–ø–ª–æ–π**:
    - –°–æ–±–∏—Ä–∞–µ—Ç Docker –æ–±—Ä–∞–∑ –¥–ª—è ARM (Raspberry Pi).
    - –ü—É–±–ª–∏–∫—É–µ—Ç –æ–±—Ä–∞–∑ –≤ Docker Hub.

### –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ CI/CD:
| –ü–µ—Ä–µ–º–µ–Ω–Ω–∞—è           | –û–ø–∏—Å–∞–Ω–∏–µ                  |
|----------------------|---------------------------|
| `DOCKERHUB_IMAGE`    | –ò–º—è –æ–±—Ä–∞–∑–∞ –≤ Docker Hub   |
| `DOCKERHUB_USERNAME` | –õ–æ–≥–∏–Ω Docker Hub (—Å–µ–∫—Ä–µ—Ç) |
| `DOCKERHUB_PASSWORD` | –¢–æ–∫–µ–Ω Docker Hub (—Å–µ–∫—Ä–µ—Ç) |

---

## –õ–æ–∫–∞–ª—å–Ω–∞—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∞

### –ó–∞–ø—É—Å–∫ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
```bash
./mvnw spring-boot:run
```

## –î–∞—Ç—á–∏–∫–∏:
* —Ç–µ–º–ø–µ—Ä–∞—Ç—É—Ä–∞ (—Ç–∞–∫–∂–µ –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ –¥–∞—Ç—á–∏–∫ –≤–ª–∞–∂–Ω–æ—Å—Ç–∏ –≤–æ–∑–¥. –∏ –¥–∞–≤–ª–µ–Ω–∏—è) 3—à—Ç
* –≤–ª–∞–∂–Ω–æ—Å—Ç—å –ø–æ—á–≤—ã. –ü–æ –∫–æ–ª–∏—á–µ—Å—Ç–≤—É –≥—Ä—è–¥–æ–∫.
* –∫–∞–º–µ—Ä–∞ (—Ñ–æ—Ç–æ 3 —Ä–∞–∑–∞ –≤ –¥–µ–Ω—å) 1—à—Ç

## –£—Å—Ç—Ä–æ–π—Å—Ç–≤–∞:
* –ø—Ä–∏–≤–æ–¥ –æ–∫–Ω–∞ (3 –ø–æ–ª–æ–∂–µ–Ω–∏—è: 0=–∑–∞–∫—Ä—ã—Ç–æ, 50=–ø–æ–ª–æ–≤–∏–Ω–∞, 100=–æ—Ç–∫—Ä—ã—Ç–æ 1—à—Ç
* –∫–ª–∞–ø–∞–Ω –ø–æ–ª–∏–≤–∞ (0=–∑–∞–∫—Ä—ã—Ç, 1=–æ—Ç–∫—Ä—ã—Ç). –ü–æ –∫–æ–ª–∏—á–µ—Å—Ç–≤—É –≥—Ä—è–¥–æ–∫.
* –ø—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω—ã–π –≤–µ–Ω—Ç–∏–ª—è—Ç–æ—Ä (0=–≤—ã–∫–ª, 1=–≤–∫–ª) 1—à—Ç
* –ø–æ–¥–æ–≥—Ä–µ–≤ (0=–≤—ã–∫–ª, 1=–≤–∫–ª) 1—à—Ç

## –¢–æ–ø–∏–∫–∏ –¥–ª—è –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏—è —Å —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞–º–∏
* temperature_ground,
* temperature_middle,
* temperature_ceil, 
* humidity_air, 
* humidity_ground, 
* pressure_air, 
* heating, 
* windows, 
* valve_water, 
* fan_cooling,


# üì° MQTT –ü—Ä–æ—Ç–æ–∫–æ–ª –≤ Polytech Smart Greenhouse

## üß≠ –û–±—â–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ —Å–æ–æ–±—â–µ–Ω–∏–π

–í—Å–µ MQTT-—Å–æ–æ–±—â–µ–Ω–∏—è –∏–º–µ—é—Ç —Å–ª–µ–¥—É—é—â—É—é —Å—Ç—Ä—É–∫—Ç—É—Ä—É:

```
<deviceName>:<value>
```


–ü—Ä–∏–º–µ—Ä—ã:
- `valve_bed_1:1` ‚Äî –∫–æ–º–∞–Ω–¥–∞ –æ—Ç–∫—Ä—ã—Ç—å –∫–ª–∞–ø–∞–Ω.
- `sensor_42:23.7` ‚Äî –ø–æ–∫–∞–∑–∞–Ω–∏–µ –¥–∞—Ç—á–∏–∫–∞ —Ç–µ–º–ø–µ—Ä–∞—Ç—É—Ä—ã.

---

## üì§ –ü—É–±–ª–∏–∫–∞—Ü–∏—è –∫–æ–º–∞–Ω–¥ –Ω–∞ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞ (–∏–∑ `DeviceControlService`)

### –¢–æ–ø–∏–∫–∏ –∏ —Å–æ–æ–±—â–µ–Ω–∏—è –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞–º–∏

–°–µ—Ä–≤–∏—Å `DeviceControlService` –ø—É–±–ª–∏–∫—É–µ—Ç –∫–æ–º–∞–Ω–¥—ã –Ω–∞ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞ –ø–æ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–∏–º —Ç–æ–ø–∏–∫–∞–º.

| –¢–∏–ø —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞ | –¢–æ–ø–∏–∫         | –ü—Ä–∏–º–µ—Ä –∫–æ–º–∞–Ω–¥—ã  | –û–ø–∏—Å–∞–Ω–∏–µ             |
|----------------|---------------|-----------------|----------------------|
| –ö–ª–∞–ø–∞–Ω –ø–æ–ª–∏–≤–∞  | `valve_water` | `valve_bed_1:1` | –í–∫–ª—é—á–∏—Ç—å –∫–ª–∞–ø–∞–Ω      |
| –û–∫–Ω–∞           | `windows`     | `window_1:0`    | –ó–∞–∫—Ä—ã—Ç—å –æ–∫–Ω–æ         |
| –û–±–æ–≥—Ä–µ–≤        | `heating`     | `heater_3:1`    | –í–∫–ª—é—á–∏—Ç—å –æ–±–æ–≥—Ä–µ–≤     |
| –í–µ–Ω—Ç–∏–ª—è—Ü–∏—è     | `fan_cooling` | `fan_2:0`       | –í—ã–∫–ª—é—á–∏—Ç—å –≤–µ–Ω—Ç–∏–ª—è—Ç–æ—Ä |

**–§–æ—Ä–º–∞—Ç**:  

```
deviceName:command
```

–≥–¥–µ `command` ‚Äî —ç—Ç–æ —Å—Ç—Ä–æ–∫–∞, –æ–±—ã—á–Ω–æ `"1"` (–≤–∫–ª) –∏–ª–∏ `"0"` (–≤—ã–∫–ª).

---

## üì• –ü–æ–¥–ø–∏—Å–∫–∞ –Ω–∞ —Å–µ–Ω—Å–æ—Ä—ã (–∏–∑ `SensorService`)

### –¢–æ–ø–∏–∫–∏ –∏ —Å–æ–æ–±—â–µ–Ω–∏—è –æ—Ç —Å–µ–Ω—Å–æ—Ä–æ–≤

–°–µ—Ä–≤–∏—Å `SensorService` –ø–æ–¥–ø–∏—Å—ã–≤–∞–µ—Ç—Å—è –Ω–∞ —Å–ª–µ–¥—É—é—â–∏–µ —Ç–æ–ø–∏–∫–∏ –∏ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç —Å–æ–æ–±—â–µ–Ω–∏—è, —Å–æ–¥–µ—Ä–∂–∞—â–∏–µ –ø–æ–∫–∞–∑–∞–Ω–∏—è –æ—Ç –¥–∞—Ç—á–∏–∫–æ–≤.

| –¢–∏–ø —Å–µ–Ω—Å–æ—Ä–∞                   | –¢–æ–ø–∏–∫                | –ü—Ä–∏–º–µ—Ä —Å–æ–æ–±—â–µ–Ω–∏—è | –ï–¥–∏–Ω–∏—Ü—ã –∏–∑–º–µ—Ä–µ–Ω–∏—è |
|-------------------------------|----------------------|------------------|-------------------|
| –¢–µ–º–ø–µ—Ä–∞—Ç—É—Ä–∞ (–ø–æ—á–≤–∞)           | `temperature_ground` | `sensor_1:21.4`  | ¬∞C                |
| –¢–µ–º–ø–µ—Ä–∞—Ç—É—Ä–∞ (—Å—Ä–µ–¥–Ω–∏–π —É—Ä–æ–≤–µ–Ω—å) | `temperature_middle` | `sensor_2:23.1`  | ¬∞C                |
| –¢–µ–º–ø–µ—Ä–∞—Ç—É—Ä–∞ (–ø–æ—Ç–æ–ª–æ–∫)         | `temperature_ceil`   | `sensor_3:25.7`  | ¬∞C                |
| –í–ª–∞–∂–Ω–æ—Å—Ç—å (–≤–æ–∑–¥—É—Ö)            | `humidity_air`       | `sensor_4:60.2`  | %                 |
| –í–ª–∞–∂–Ω–æ—Å—Ç—å (–ø–æ—á–≤–∞)             | `humidity_ground`    | `sensor_5:35.8`  | %                 |
| –î–∞–≤–ª–µ–Ω–∏–µ (–≤–æ–∑–¥—É—Ö)             | `pressure_air`       | `sensor_6:101.3` | kPa (–∏–ª–∏ –≥–ü–∞)     |

**–§–æ—Ä–º–∞—Ç**:  

```
deviceName:value
```


---

## üíß –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –ø–æ–ª–∏–≤ (`IrrigationService`)

–°–µ—Ä–≤–∏—Å `IrrigationService` –∏—Å–ø–æ–ª—å–∑—É–µ—Ç `DeviceControlService` –¥–ª—è –æ—Ç–ø—Ä–∞–≤–∫–∏ –∫–æ–º–∞–Ω–¥ –Ω–∞ **–∫–ª–∞–ø–∞–Ω—ã**.

- –ü—Ä–∏ –Ω–∞—Å—Ç—É–ø–ª–µ–Ω–∏–∏ –≤—Ä–µ–º–µ–Ω–∏ –ø–æ–ª–∏–≤–∞:
   - –ü—É–±–ª–∏–∫—É–µ—Ç—Å—è –∫–æ–º–∞–Ω–¥–∞ `deviceName:1` –≤ —Ç–æ–ø–∏–∫ `valve_water`.
   - –ü–æ –∏—Å—Ç–µ—á–µ–Ω–∏–∏ –∑–∞–¥–∞–Ω–Ω–æ–π –ø—Ä–æ–¥–æ–ª–∂–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ –ø–æ–ª–∏–≤–∞ –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç—Å—è `deviceName:0`.

–ü—Ä–∏–º–µ—Ä:

```
valve_bed_3:1 // –æ—Ç–∫—Ä—ã—Ç—å –∫–ª–∞–ø–∞–Ω –≤ 08:00
...–ø—Ä–æ—à–ª–æ 10 –º–∏–Ω—É—Ç...
valve_bed_3:0 // –∑–∞–∫—Ä—ã—Ç—å –∫–ª–∞–ø–∞–Ω –≤ 08:10
```